Header
  + name := MAIN;
  
  //- external := `void die_with_code(long c){exit(c);};`;
  
Inherit
  - parent_utils:UTILS := UTILS
  
Public
  
  - cpt:INTEGER
  
  - load_directory path:STRING_ALIAS <-
  ( + dirent:DIRENT
    + dir:DIRECTORY
    trace (path)
    dirent := FILE_SYSTEM.get path
    (dirent = NULL).if {
      ("Error: cannot open '" + path + "'").println
      exit 0
    }
    TEST.check_not_null (dirent.path)
    trace (dirent.path)
    cpt_increment "ici"
    ((dirent.is_directory) && {dirent.open}).if {
      dir ?= dirent
      dir.sort
      (dir.lower).to (dir.upper) do { j:INTEGER
        ("j=" + j.to_string + " ").print
        cpt_increment "la"
        load_directory (dir.at j.path)
      }
    }
  )
  
  - main <-
  ( + path:STRING_ALIAS
    STRING.tmp { tmp:STRING_BUFFER
      ENVIRONMENT.pwd_in tmp
      path := tmp.to_string_alias
    }
    TEST.check (path.has_suffix "6/") txt {path}
    TEST.check (COMMAND_ARGS.count) integer 2
    load_directory (COMMAND_ARGS.first)
    cpt_increment "main"
  )
  
  - cpt_increment name:STRING <-
  (
    cpt := cpt + 1
    ("cpt." + name + "=" + cpt.to_string).println
  )
  
  - trace path:STRING <-
  ( + i:INTEGER
    ((i := path.first_substring_index "/lisaac/") < 0).if {
      i := 0
    }
    i.to (path.upper) do { k:INTEGER
      STDOUT.put_character (path.item k)
    }
    STDOUT.put_character '\n'
  )
  
